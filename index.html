<!DOCTYPE html>
<html lang="ko">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2413601181805662"
     crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YLZZCG8BHH"></script>

<script>
function drawChart(buyPrice, feeRate, amount) {
  const labels = [];
  const dcaData = [];
  const targetLine = [];
  const goalRoi = 20; // 목표 수익률 20%

  for (let i = 0.8; i <= 1.5; i += 0.05) {
    const targetPrice = buyPrice * i;
    const dcaPrice = (buyPrice * 0.5 + targetPrice * 0.5); // 50%씩 매수했다고 가정
    const revenue = ((targetPrice - dcaPrice) * amount) * (1 - feeRate / 100);
    labels.push(targetPrice.toFixed(0) + "원");
    dcaData.push((revenue).toFixed(2));

    const goalProfit = ((dcaPrice * (goalRoi / 100)) * amount) * (1 - feeRate / 100);
    targetLine.push(goalProfit.toFixed(2));
  }

  const ctx = document.getElementById('roiChart').getContext('2d');
  if (window.roiChart) {
    window.roiChart.destroy();
  }

  window.roiChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'DCA 예상 수익 (₩)',
          data: dcaData,
          borderColor: '#00e676',
          backgroundColor: 'rgba(0, 230, 118, 0.2)',
          tension: 0.4,
          fill: true
        },
        {
          label: '목표 수익선 (20%)',
          data: targetLine,
          borderColor: '#ff1744',
          borderDash: [5, 5],
          fill: false,
          tension: 0.4
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          labels: {
            color: '#ffffff'
          }
        }
      },
      scales: {
        x: {
          ticks: { color: '#ffffff' },
          grid: { color: '#444' }
        },
        y: {
          ticks: { color: '#ffffff' },
          grid: { color: '#444' }
        }
      }
    }
  });
}

document.querySelector("button").addEventListener("click", () => {
  const buyPrice = parseFloat(document.getElementById("buyPrice").value);
  const feeRate = parseFloat(document.getElementById("feeRate").value);
  const amount = parseFloat(document.getElementById("amount").value);
  if (!isNaN(buyPrice) && !isNaN(feeRate) && !isNaN(amount)) {
    drawChart(buyPrice, feeRate, amount);
  }
});
</script>

</body>
</html>
